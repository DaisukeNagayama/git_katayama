Extension = 5;

%% Clutch 16
%{
Query = {Clutch16001};
Database = {Clutch16001, Clutch16002, Clutch16003, Clutch16004, Clutch16005};

% 40パターン
QueryRotAzi = [288;48;22;226;60;122;97;354;251;62;69;308;174;210;297;39;214;64;251;115;259;220;55;315;87;24;124;139;166;13;123;330;33;232;75;162;238;221;115;230];
QueryRotEle = [82;31;72;53;19;171;76;54;120;6;66;116;22;45;177;163;4;76;126;96;174;140;51;93;122;46;140;165;139;32;109;48;104;117;128;83;75;105;21;98];
QueryTranslation = [4,-2,-2;0,4,5;-9,-3,-2;4,-1,-4;1,-1,8;5,3,3;4,5,-6;-4,-7,5;-1,-2,-5;0,-3,-9;-8,-6,-1;-7,-1,4;-3,-6,1;5,-2,-7;-5,-6,5;-1,2,3;0,1,8;3,4,-1;-6,-6,2;-5,2,1;0,3,-1;-1,-1,6;-2,-5,-4;4,4,5;-6,3,1;-2,0,0;2,2,-3;-5,3,-3;3,-5,-7;5,5,8;6,-6,0;6,0,5;-9,5,5;0,-1,-2;2,-7,-2;8,0,-1;-1,-3,5;8,0,5;-1,-1,-5;-7,3,2];

DatabaseRotAzi = [219;318;158;123;143];
DatabaseRotEle = [103;130;21;68;93];
DatabaseTranslation = [0,3,0;0,-4,1;-6,-6,3;1,-4,-1;2,0,-5];
%}

%% Clutch 32
%{
Query = {Clutch32001};
Database = {Clutch32001, Clutch32002, Clutch32003, Clutch32004, Clutch32005};

% 40パターン
QueryRotAzi = [288;48;22;226;60;122;97;354;251;62;69;308;174;210;297;39;214;64;251;115;259;220;55;315;87;24;124;139;166;13;123;330;33;232;75;162;238;221;115;230];
QueryRotEle = [82;31;72;53;19;171;76;54;120;6;66;116;22;45;177;163;4;76;126;96;174;140;51;93;122;46;140;165;139;32;109;48;104;117;128;83;75;105;21;98];
QueryTranslation = [14,-3,4;1,4,6;-13,-4,2;0,6,3;0,-3,-8;5,-1,10;-13,5,-7;9,5,-1;-9,-5,3;4,-7,8;12,-3,1;-4,-4,4;3,-4,1;-2,-6,-10;-1,-4,-5;-3,-5,-3;3,-5,4;-2,-1,-5;-7,1,-4;2,6,3;2,6,9;2,6,-8;-5,6,4;-1,2,-2;-3,-5,-2;-9,-1,-5;9,1,7;-2,-1,9;9,0,9;4,0,10;9,6,2;-3,-1,6;-15,-5,-1;1,-7,2;9,-6,-1;-7,6,1;-7,-6,0;9,4,5;-4,0,9;-13,4,5];

DatabaseRotAzi = [219;318;158;123;143];
DatabaseRotEle = [103;130;21;68;93];
DatabaseTranslation = [-9,-6,0;7,-1,-2;0,-6,-11;10,1,-5;12,-7,-1];
%}

%% Clutch 48
%{
Query = {Clutch48001};
Database = {Clutch48001, Clutch48002, Clutch48003, Clutch48004, Clutch48005};

% 40パターン
QueryRotAzi = [288;48;22;226;60;122;97;354;251;62;69;308;174;210;297;39;214;64;251;115;259;220;55;315;87;24;124;139;166;13;123;330;33;232;75;162;238;221;115;230];
QueryRotEle = [82;31;72;53;19;171;76;54;120;6;66;116;22;45;177;163;4;76;126;96;174;140;51;93;122;46;140;165;139;32;109;48;104;117;128;83;75;105;21;98];
QueryTranslation = [1,-3,3;-8,5,5;-14,5,-6;3,0,-7;-8,4,9;-1,-7,4;-14,4,-1;-8,6,4;10,-7,-5;3,3,11;-1,-2,1;11,2,0;-3,3,-4;2,6,8;6,6,14;-7,-8,-16;-3,-8,-5;-7,1,5;-6,-3,8;-7,-5,0;4,-2,8;2,-1,-1;11,-7,-6;-2,1,5;-1,-1,4;-2,5,-2;0,0,-8;-7,-6,14;-6,5,5;7,7,-11;-5,8,2;9,-1,-11;4,-5,0;6,1,2;-2,-5,-2;-21,2,7;-16,-8,6;-11,-8,6;-6,7,-14;-7,1,1];

DatabaseRotAzi = [219;318;158;123;143];
DatabaseRotEle = [103;130;21;68;93];
DatabaseTranslation = [6,2,-1;-9,3,-6;3,5,-15;16,-7,5;15,-7,0];
%}

%% Clutch 64
%{
Query = {Clutch64001};
Database = {Clutch64001, Clutch64002, Clutch64003, Clutch64004, Clutch64005};

% 40パターン
QueryRotAzi = [288;48;22;226;60;122;97;354;251;62;69;308;174;210;297;39;214;64;251;115;259;220;55;315;87;24;124;139;166;13;123;330;33;232;75;162;238;221;115;230];
QueryRotEle = [82;31;72;53;19;171;76;54;120;6;66;116;22;45;177;163;4;76;126;96;174;140;51;93;122;46;140;165;139;32;109;48;104;117;128;83;75;105;21;98];
QueryTranslation = [-3,4,-8;-3,6,10;0,-2,1;-2,-9,11;-3,-6,-1;7,-8,12;1,8,-2;5,1,-1;-12,-7,10;0,6,7;-2,8,-9;-5,-7,-1;3,-4,-5;-5,2,-7;4,-4,6;7,5,-12;-1,-4,-20;-21,2,-2;4,-9,-9;8,-1,5;0,-5,-20;-2,-8,-7;-2,0,-3;25,1,7;-8,3,4;-8,3,7;4,-8,3;-9,0,-4;-5,6,-1;4,-1,-12;-14,5,-5;7,-7,-6;8,0,-2;5,2,9;-7,-6,1;9,5,-3;16,5,-4;1,6,-4;7,3,-1;8,0,5];

DatabaseRotAzi = [219;318;158;123;143];
DatabaseRotEle = [103;130;21;68;93];
DatabaseTranslation = [-10,-1,4;-14,2,-2;6,-3,-11;1,2,-3;10,9,4];
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Die 16
%{
Query = {Die16001};
Database = {Die16001, Die16002, Die16003, Die16004, Die16005};

% 40パターン
QueryRotAzi = [157;319;214;73;250;56;263;264;254;18;28;44;55;187;186;306;36;238;159;192;208;108;130;93;254;1;97;338;95;344;245;278;145;213;12;68;199;344;130;225];
QueryRotEle = [149;168;91;82;130;101;65;77;20;41;120;121;4;155;26;165;91;93;170;100;156;72;25;54;44;40;31;40;12;78;127;41;57;60;96;58;49;168;34;98];
QueryTranslation = [-1,1,1;-7,1,-11;-4,-1,-7;-10,6,1;-4,-3,-7;-9,-3,-3;2,-1,0;-9,7,3;3,2,9;5,-4,3;1,-1,3;-8,-6,-7;-5,0,2;-3,-4,-10;4,2,1;-4,4,3;5,-1,6;4,-6,-4;4,-2,-3;6,6,3;0,5,-3;-9,-3,-2;-1,-7,-5;-8,8,6;1,7,8;6,-6,9;-2,-8,-2;4,4,-5;1,5,-3;-10,-4,-6;-2,-2,-4;4,-1,-2;-9,-5,-2;-10,3,-6;0,-2,-5;0,-4,-4;-1,-5,7;1,4,2;2,1,4;1,-2,-1];
DatabaseRotAzi = [188;23;226;50;310];
DatabaseRotEle = [179;73;139;125;87];
DatabaseTranslation = [5,-8,-2;-3,5,2;4,1,2;-3,0,-6;0,6,0];
%} 

%% Die 32
%{
Query = {Die32001};
Database = {Die32001, Die32002, Die32003, Die32004, Die32005};

% 40パターン
QueryRotAzi = [157;319;214;73;250;56;263;264;254;18;28;44;55;187;186;306;36;238;159;192;208;108;130;93;254;1;97;338;95;344;245;278;145;213;12;68;199;344;130;225];
QueryRotEle = [149;168;91;82;130;101;65;77;20;41;120;121;4;155;26;165;91;93;170;100;156;72;25;54;44;40;31;40;12;78;127;41;57;60;96;58;49;168;34;98];
QueryTranslation = [-3,5,-12;5,-8,-4;0,1,-1;-9,2,9;-1,8,-10;-4,-8,-1;-1,-9,7;-7,9,-2;-10,-7,-6;5,-9,-4;-13,-5,-10;-2,0,-7;-6,-8,0;-12,2,-5;-6,4,11;-6,-1,-6;-9,5,8;-1,-6,-7;0,-4,-10;-3,-7,2;-10,-8,-9;-14,8,7;-4,-6,2;-6,5,1;4,9,11;-6,-5,11;-9,-9,4;4,-2,-3;-11,10,6;-7,2,6;-7,3,-8;4,5,-2;-5,2,8;-4,2,5;7,-7,-3;-8,3,9;-5,5,-1;-1,-3,5;-1,5,-4;-10,4,-7];

DatabaseRotAzi = [188;23;226;50;310];
DatabaseRotEle = [179;73;139;125;87];
DatabaseTranslation = [-12,-2,8;-10,1,-1;-10,0,2;-8,-8,-7;0,-3,3];
%}

%% Die 48
%{
Query = {Die48001};
Database = {Die48001, Die48002, Die48003, Die48004, Die48005};

% 40パターン
QueryRotAzi = [157;319;214;73;250;56;263;264;254;18;28;44;55;187;186;306;36;238;159;192;208;108;130;93;254;1;97;338;95;344;245;278;145;213;12;68;199;344;130;225];
QueryRotEle = [149;168;91;82;130;101;65;77;20;41;120;121;4;155;26;165;91;93;170;100;156;72;25;54;44;40;31;40;12;78;127;41;57;60;96;58;49;168;34;98];
QueryTranslation = [-12,4,-8;-11,-2,0;10,8,9;7,9,8;-4,-2,-12;-2,7,-7;2,-12,0;-13,-11,5;-7,11,5;1,-10,6;-4,6,-1;2,8,-9;-7,5,-10;-5,-6,0;-13,6,12;-2,-5,-18;-1,-10,-9;-19,-2,1;6,-1,-20;-11,2,5;-6,-1,2;-3,0,-1;-5,5,1;-6,-5,8;-4,3,4;-7,-1,-7;-6,13,12;0,6,10;6,7,20;-18,-2,1;-10,-11,3;0,-10,-3;-2,-3,-4;-8,-8,8;8,-11,3;-2,-6,10;-9,-11,-6;5,4,3;-3,5,-5;-10,-6,-3];

DatabaseRotAzi = [188;23;226;50;310];
DatabaseRotEle = [179;73;139;125;87];
DatabaseTranslation = [11,-6,-2;-19,-7,9;-9,6,-8;-3,-9,0;-6,8,-4];
%}

%% Die 64
%{
Query = {Die64001};
Database = {Die64001, Die64002, Die64003, Die64004, Die64005};

% 40パターン
QueryRotAzi = [157;319;214;73;250;56;263;264;254;18;28;44;55;187;186;306;36;238;159;192;208;108;130;93;254;1;97;338;95;344;245;278;145;213;12;68;199;344;130;225];
QueryRotEle = [149;168;91;82;130;101;65;77;20;41;120;121;4;155;26;165;91;93;170;100;156;72;25;54;44;40;31;40;12;78;127;41;57;60;96;58;49;168;34;98];
QueryTranslation = [-7,2,1;-10,-5,6;-3,7,-1;-11,13,6;-11,0,-6;-1,-2,4;-9,-4,11;-2,16,10;-8,3,6;3,-12,15;-7,-7,-3;-6,-10,-13;-3,7,12;-15,11,-20;-3,-15,15;5,0,-16;-4,6,-11;-22,10,0;2,-2,4;-1,-5,-10;-6,-9,-10;3,-3,2;-9,-11,5;-10,-16,6;-1,-13,3;-19,-10,-5;-14,3,19;-6,-3,7;-5,-13,-11;9,7,-11;-4,1,-12;-11,14,15;-5,8,12;2,-2,12;1,-9,-6;-10,1,-4;-13,-7,-3;6,6,-20;-14,-5,11;-10,-5,-3];

DatabaseRotAzi = [188;23;226;50;310];
DatabaseRotEle = [179;73;139;125;87];
DatabaseTranslation = [-11,-12,-26;-10,-3,9;1,10,-14;-16,0,-5;-13,4,6];
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Gear 16
%{
Query = {Gear16001};
Database = {Gear16001, Gear16002, Gear16003, Gear16004, Gear16005};

% 40パターン
QueryRotAzi = [274;44;71;4;141;20;234;21;67;98;157;284;179;305;345;92;83;32;200;114;97;105;32;210;142;48;171;290;192;351;95;70;179;328;341;186;145;254;193;209];
QueryRotEle = [137;91;121;96;4;81;131;176;35;27;16;42;116;91;112;155;104;58;95;81;94;153;151;51;149;121;163;81;128;14;137;179;146;35;137;179;168;101;173;96];
QueryTranslation = [5,4,-6;-2,-9,-3;-6,-1,1;3,-2,0;5,5,1;5,-8,4;-2,-5,4;-3,-6,-8;8,2,6;7,3,6;-4,5,5;-4,-8,4;-6,3,-1;1,-6,0;0,-7,-1;6,-7,-2;1,-3,7;3,-5,1;5,1,4;5,5,-7;-6,-6,-8;-8,2,1;5,3,-3;-2,-4,2;-7,2,4;2,-4,1;-2,-7,3;2,-4,7;-5,-3,-3;-5,-5,4;-6,0,-4;-2,6,-5;-8,6,1;0,1,-6;6,-2,2;-3,-8,0;0,-6,-8;4,-9,-4;4,7,0;3,3,2];

DatabaseRotAzi = [77;159;111;107;274];
DatabaseRotEle = [161;2;82;11;114];
DatabaseTranslation = [1,7,0;-2,1,-1;-7,-1,0;-3,-2,4;-1,-1,-7];
%}

%% Gear 32
%{
Query = {Gear32001};
Database = {Gear32001, Gear32002, Gear32003, Gear32004, Gear32005};

% 40パターン
QueryRotAzi = [274;44;71;4;141;20;234;21;67;98;157;284;179;305;345;92;83;32;200;114;97;105;32;210;142;48;171;290;192;351;95;70;179;328;341;186;145;254;193;209];
QueryRotEle = [137;91;121;96;4;81;131;176;35;27;16;42;116;91;112;155;104;58;95;81;94;153;151;51;149;121;163;81;128;14;137;179;146;35;137;179;168;101;173;96];
QueryTranslation = [-6,-5,2;4,9,9;-11,11,-6;8,2,-9;-10,-6,6;-8,-4,-9;-6,-9,2;-8,1,-7;4,0,-4;5,9,8;-9,1,-11;-8,-10,-2;-5,-4,-5;-3,-2,4;4,-4,5;4,10,-8;-9,5,4;-7,-10,2;6,7,-8;4,9,-2;-9,-3,4;-10,0,-1;8,-7,-7;0,-7,8;-5,0,5;5,-1,6;6,6,-8;0,4,-6;5,-1,1;-7,-8,-4;8,2,-5;3,7,-10;7,5,-6;4,-3,9;-6,-6,5;-4,3,9;-4,-11,4;-3,-1,-8;-12,-7,5;-4,-1,3];

DatabaseRotAzi = [77;159;111;107;274];
DatabaseRotEle = [161;2;82;11;114];
DatabaseTranslation = [5,8,-3;-6,0,-10;-5,4,1;-5,11,-8;4,-11,-2];
%}

%% Gear 48
%{
Query = {Gear48001};
Database = {Gear48001, Gear48002, Gear48003, Gear48004, Gear48005};

% 40パターン
QueryRotAzi = [274;44;71;4;141;20;234;21;67;98;157;284;179;305;345;92;83;32;200;114;97;105;32;210;142;48;171;290;192;351;95;70;179;328;341;186;145;254;193;209];
QueryRotEle = [137;91;121;96;4;81;131;176;35;27;16;42;116;91;112;155;104;58;95;81;94;153;151;51;149;121;163;81;128;14;137;179;146;35;137;179;168;101;173;96];
QueryTranslation = [7,-9,-11;0,-7,-8;3,2,-7;-12,-8,-14;-5,8,0;-6,-4,1;3,2,6;-1,4,-9;-10,-2,9;-4,16,2;-3,8,8;9,-10,-4;8,4,1;11,-2,14;-3,2,3;-3,3,-10;5,6,4;8,-9,9;10,-4,7;-6,-4,-10;3,5,7;-6,-4,-3;-2,5,-8;-14,4,-14;-8,2,-2;-1,7,9;-4,-8,-12;9,8,12;4,-9,-11;-11,-11,7;-9,8,6;-1,0,7;-6,-6,4;1,-4,7;-10,12,-6;-15,-11,6;6,3,4;11,-5,4;-6,11,-14;12,3,-3];

DatabaseRotAzi = [77;159;111;107;274];
DatabaseRotEle = [161;2;82;11;114];
DatabaseTranslation = [-1,-1,-9;6,2,7;-5,-4,-6;-6,13,6;-6,-3,6];
%}

%% Gear 64
%{
Query = {Gear64001};
Database = {Gear64001, Gear64002, Gear64003, Gear64004, Gear64005};

% 40パターン
QueryRotAzi = [274;44;71;4;141;20;234;21;67;98;157;284;179;305;345;92;83;32;200;114;97;105;32;210;142;48;171;290;192;351;95;70;179;328;341;186;145;254;193;209];
QueryRotEle = [137;91;121;96;4;81;131;176;35;27;16;42;116;91;112;155;104;58;95;81;94;153;151;51;149;121;163;81;128;14;137;179;146;35;137;179;168;101;173;96];
QueryTranslation = [1,0,4;-5,-13,-9;-5,9,-5;-8,13,6;4,7,13;3,3,2;-2,1,-15;-3,0,14;-3,15,-2;-4,2,-12;5,-18,0;-1,-3,-13;-6,9,15;-7,6,-6;0,-8,-15;12,13,6;8,3,15;2,-16,7;10,12,12;7,-9,-13;14,13,-7;13,8,-9;1,11,-11;6,-8,-4;6,-12,-8;-1,-10,-8;-4,-17,-17;-3,4,-3;13,-4,3;-3,-1,-4;14,-4,8;6,1,6;-6,-14,-1;-1,10,-11;0,-7,1;4,14,5;-2,-12,-5;8,8,10;-16,-13,-7;13,3,0];

DatabaseRotAzi = [77;159;111;107;274];
DatabaseRotEle = [161;2;82;11;114];
DatabaseTranslation = [-15,-2,-14;15,-13,-13;-13,16,-7;-9,-9,-1;-13,-21,8];
%}

%% モデルサイズ拡張

PatternQuery = length(QueryRotEle);
disp(strcat('姿勢パターン：',num2str(PatternQuery)))

TimeStart = clock;

NQ = length(Query);% クエリモデル数
ND = length(Database);% データベースモデル数

for iq0 = 1:NQ
    Q0 = Query{iq0};
    Query{iq0} = ExtendSizeOfModel(Q0,Extension);
end

for id0 = 1:ND
    D0 = Database{id0};
    Database{id0} = ExtendSizeOfModel(D0,Extension);
end

for id = 1:ND
    D = Database{id};
    DR = rot3d(D, DatabaseRotEle(id), DatabaseRotAzi(id), 'nearest');
    DRT = circshift(DR,DatabaseTranslation(id,:));
    GroundWallOfSpace(DRT)
end

Q = Query{1};
for iq = 1:length(QueryRotEle)
    QR = rot3d(Q, QueryRotEle(iq), QueryRotAzi(iq), 'nearest');
    QRT = circshift(QR,QueryTranslation(iq,:));
    GroundWallOfSpace(QRT)
end